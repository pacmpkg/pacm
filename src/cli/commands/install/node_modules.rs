use crate::manifest::Manifest;
use std::path::PathBuf;

pub(super) fn node_modules_intact(manifest: &Manifest, workspace_names: &[String]) -> bool {
    let node_modules = PathBuf::from("node_modules");
    if !node_modules.exists() {
        return false;
    }
    let pacm_dir = node_modules.join(".pacm");
    if !pacm_dir.exists() {
        return false;
    }

    for name in manifest
        .dependencies
        .keys()
        .chain(manifest.dev_dependencies.keys())
        .chain(manifest.optional_dependencies.keys())
    {
        if !node_modules.join(name).exists() {
            return false;
        }
    }
    for name in workspace_names {
        if !node_modules.join(name).exists() {
            return false;
        }
    }
    true
}
